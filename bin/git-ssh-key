#!/bin/sh

_git_ssh_key_usage(){
  echo "$0"
}

_git_ssh_key_list(){
  git api GET /user/keys | jshon -a -e id -u -p -e title -u |\
    sed -e '{N;s/\n/ /}' | column -t
  exit
}

_git_ssh_key_add(){
  title="$1"
  pubkey_file="$2"
  body="{\"title\": \"$title\", \"key\": \"$(cat $pubkey_file)\"}"
  git api POST /user/keys "$body"
}

_git_ssh_key_rm(){
  id=$1
  test -z $id && echo "id required." >&2 && exit 1
  git api DELETE /user/keys/$id
}

test $# -eq 0 && _git_ssh_key_list

subcommand=$1
shift
case $subcommand in
  add) _git_ssh_key_add $* ;;
  rm) _git_ssh_key_rm $* ;;
  *) _git_ssh_key_usage ;;
esac
